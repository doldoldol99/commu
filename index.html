<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‚˜ë§Œì˜ íŠ¸ìœ„í„°</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* ==========================================
           [ğŸ¨ ë””ìì¸ í…Œë§ˆ]
           ========================================== */
        :root {
            --bg-main: #121212; --bg-card: #1E1E1E; --bg-sub: #2C2C2C;
            --text-main: #E0E0E0; --text-sub: #A9A9A9; --border-color: #2C2C2C;
            --point-color: #8FBC8F; --point-color-dim: #556B2F; --point-bg-tint: #2F3B2F;
            --danger-color: #ff6b6b; --shadow-color: rgba(0,0,0,0.5);
            --link-color: #4da6ff; --thread-line-color: #4a4a4a;
            --nav-icon-color: #FFFFFF;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --shadow-card: 0 4px 6px var(--shadow-color);
            --border-radius-card: 20px; --border-radius-btn: 9999px;
        }

        [data-theme="light"] {
            --bg-main: #F5F7F5; --bg-card: #FFFFFF; --bg-sub: #E0E0E0;
            --text-main: #2F3B2F; --text-sub: #666666; --border-color: #E0E0E0;
            --point-color: #697644; --point-color-dim: #8FBC8F; --point-bg-tint: #E8F5E9;
            --shadow-color: rgba(0,0,0,0.1); --link-color: #0066cc; --thread-line-color: #d0d0d0;
            --nav-icon-color: #000000;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-main); -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-main); padding-bottom: 80px; color: var(--text-main); transition: background 0.3s, color 0.3s; }
        
        /* ìŠ¤í¬ë¡¤ ì ê¸ˆ ë° ë¸”ëŸ¬ íš¨ê³¼ */
        body.scroll-locked { overflow: hidden; }
        .blur-mode { filter: blur(5px); pointer-events: none; user-select: none; opacity: 0.6; }

        button { font-family: var(--font-main); cursor: pointer; }
        a { color: var(--point-color); text-decoration: none; }
        .link-text { color: var(--link-color); text-decoration: underline; cursor: pointer; word-break: break-all; }
        .mention-tag { color: var(--point-color); font-weight: bold; background: var(--point-bg-tint); padding: 2px 6px; border-radius: 6px; }

        /* ëª¨ë‹¬ ê³µí†µ */
        .modal-overlay { display: none; position: fixed; z-index: 5000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
        #image-modal { background-color: rgba(0,0,0,0.95); flex-direction: column; }
        .modal-content-img { max-width: 100%; max-height: 80vh; object-fit: contain; }
        .close-modal-btn { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; z-index: 5002; background: rgba(0,0,0,0.3); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .modal-nav-btn { position: absolute; top: 50%; transform: translateY(-50%); color: white; font-size: 40px; cursor: pointer; z-index: 5001; padding: 20px; opacity: 0.7; background: none; border: none; }
        .prev-btn { left: 10px; } .next-btn { right: 10px; }
        .modal-counter { position: absolute; bottom: 30px; color: white; background: rgba(0,0,0,0.5); padding: 5px 12px; border-radius: 20px; }

        /* í—¤ë” */
        .header { position: sticky; top: 0; z-index: 100; background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 16px 20px; margin: 10px auto; border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); transition: background 0.3s; max-width: 600px; }
        [data-theme="light"] .header { background: rgba(255, 255, 255, 0.95); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .header-title { font-weight: 800; font-size: 22px; color: var(--text-main); }

        #user-menu-dropdown { display: none; position: absolute; top: 70px; right: 20px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: var(--shadow-card); z-index: 200; width: 180px; overflow: hidden; }
        .menu-item { padding: 12px 16px; cursor: pointer; color: var(--text-main); font-size: 15px; display: flex; align-items: center; gap: 10px; transition: background 0.2s; }
        .menu-item:hover { background-color: var(--bg-sub); }
        .menu-item.danger { color: var(--danger-color); }

        .page { display: none; max-width: 600px; margin: 0 auto; position: relative; }
        .page.active { display: block; }
        
        .tweet-input-box { background: var(--bg-card); padding: 16px; margin: 10px; border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); position: relative; }
        textarea { width: 100%; height: 80px; border: 1px solid var(--border-color); resize: none; font-size: 16px; outline: none; margin-bottom: 10px; padding: 12px; border-radius: 12px; background: var(--bg-main); color: var(--text-main); transition: background 0.3s; }
        textarea:focus { border-color: var(--point-color); }
        .tweet-btn { background-color: var(--point-color); color: var(--bg-main); border: none; padding: 10px 20px; border-radius: var(--border-radius-btn); font-weight: 700; font-size: 15px; cursor: pointer; transition: background 0.2s; }
        .tweet-btn:hover { opacity: 0.9; }
        .tweet-btn:disabled { background-color: var(--bg-sub); color: var(--text-sub); cursor: not-allowed; }
        .char-counter { font-size: 12px; color: var(--text-sub); margin-right: 10px; }
        .char-counter.warning { color: var(--danger-color); font-weight: bold; }

        .full-btn { width: 100%; padding: 12px; border-radius: var(--border-radius-btn); border: none; cursor: pointer; font-weight: bold; margin-bottom: 10px; font-size: 16px; }
        .btn-blue { background: var(--point-color); color: var(--bg-main); }
        .btn-gray { background: var(--bg-sub); color: var(--text-main); }
        .btn-danger { background: var(--bg-sub); color: var(--danger-color); border: 1px solid var(--danger-color); }
        .btn-danger:hover { background: var(--danger-color); color: white; }

        .feed { padding: 0 10px; position: relative; }
        
        /* ë¡œê·¸ì¸ ì•ˆë‚´ì°½ (ì¤‘ì•™ ë°°ì¹˜) */
        #login-guide { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.8); padding: 30px; border-radius: 20px; text-align: center; 
            z-index: 2000; width: 80%; max-width: 320px; border: 1px solid var(--point-color);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        #login-guide h3 { margin-bottom: 10px; color: var(--point-color); font-size: 22px; }
        #login-guide p { margin-bottom: 25px; color: #fff; line-height: 1.5; font-size: 15px; }
        #login-guide .guide-icon { font-size: 50px; margin-bottom: 15px; display: block; }

        .thread-group { background: var(--bg-card); margin-bottom: 12px; border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); overflow: hidden; border: 1px solid var(--border-color); }
        .thread-group .tweet { margin-bottom: 0; border-bottom: none; border-radius: 0; }
        .thread-group .tweet:last-child { border-bottom: none; }
        .tweet { background: var(--bg-card); padding: 16px; display: flex; gap: 12px; position: relative; cursor: pointer; transition: background 0.1s; z-index: 1; }
        .tweet.single { margin-bottom: 12px; border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); border: 1px solid var(--border-color); }
        .tweet-left { display: flex; flex-direction: column; align-items: center; width: 48px; flex-shrink: 0; position: relative; }
        .thread-line-up { position: absolute; top: -16px; bottom: 50%; left: 50%; transform: translateX(-50%); width: 2px; background-color: var(--thread-line-color); z-index: 0; display: none; }
        .thread-line-down { position: absolute; top: 50%; bottom: -16px; left: 50%; transform: translateX(-50%); width: 2px; background-color: var(--thread-line-color); z-index: 0; display: none; }
        .tweet.has-parent .thread-line-up { display: block; }
        .tweet.has-child .thread-line-down { display: block; }
        .profile-pic { width: 48px; height: 48px; background-color: var(--bg-sub); border-radius: 50%; object-fit: cover; border: 1px solid var(--border-color); z-index: 2; position: relative; }
        .content { width: 100%; }
        .content h4 { margin-bottom: 4px; font-size: 16px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 6px; flex-wrap: wrap;}
        .user-handle { font-weight: normal; color: var(--text-sub); font-size: 14px; }
        .content p { font-size: 15px; line-height: 1.5; color: var(--text-main); white-space: pre-wrap; word-break: break-word; }
        .content .time { color: var(--text-sub); font-size: 14px; font-weight: normal; }
        .tweet.focus-tweet { background: var(--bg-card); border: 2px solid var(--point-color); border-radius: 12px; margin: 5px 0; }
        .tweet.focus-tweet .content p { font-size: 18px; line-height: 1.6; }
        .reply-indicator { font-size: 13px; color: var(--text-sub); margin-bottom: 6px; display: block; }
        .reply-indicator span { color: var(--point-color); font-weight: bold; }
        .tweet-actions { display: flex; gap: 20px; margin-top: 10px; border-top: 1px solid var(--border-color); padding-top: 10px; }
        .action-btn { background: none; border: none; color: var(--text-sub); cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; transition: color 0.2s; }
        .action-btn.active-keep { color: var(--point-color); font-weight: bold; }
        .action-btn:hover { color: var(--point-color); }
        .load-more-thread-btn { width: 100%; padding: 12px; background: var(--bg-card); color: var(--point-color); border: none; border-top: 1px solid var(--border-color); cursor: pointer; font-weight: bold; font-size: 14px; }
        .hidden-thread-item { display: none; }
        .tweet-img-grid { display: grid; gap: 2px; margin-top: 12px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border-color); width: 100%; }
        .tweet-img-item { width: 100%; height: 100%; object-fit: cover; cursor: pointer; background: var(--bg-sub); }
        .grid-1 { grid-template-columns: 1fr; } .grid-1 .tweet-img-item { aspect-ratio: 16/9; max-height: 400px; }
        .grid-2 { grid-template-columns: 1fr 1fr; aspect-ratio: 16/9; }
        .grid-3 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; aspect-ratio: 16/9; }
        .grid-3 img:first-child { grid-row: span 2; height: 100%; }
        .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; aspect-ratio: 16/9; }
        .delete-btn { position: absolute; top: 12px; right: 12px; background: none; border: none; color: var(--text-sub); cursor: pointer; font-size: 18px; padding: 4px; z-index: 10; }
        .delete-btn:hover { color: var(--danger-color); }
        .storage-bar-container { width: 100%; background-color: var(--bg-sub); height: 8px; border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .storage-bar-fill { height: 100%; background-color: var(--point-color); width: 0%; transition: width 0.3s; }
        .storage-text { font-size: 12px; color: var(--text-sub); margin-top: 4px; text-align: right; }

        .profile-header { background: var(--bg-card); padding: 30px 20px; text-align: center; border-radius: 0 0 var(--border-radius-card) var(--border-radius-card); box-shadow: var(--shadow-card); position: relative; margin: 10px; margin-top: 0; }
        .profile-img-large { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--bg-card); object-fit: cover; background-color: var(--bg-sub); box-shadow: var(--shadow-card); margin-top: -50px; cursor: pointer; }
        .profile-banner { height: 150px; background-color: var(--point-color-dim); border-radius: var(--border-radius-card); margin: 10px; margin-bottom: 0; }
        .profile-name { font-weight: 800; font-size: 22px; margin-top: 10px; color: var(--text-main); }
        .profile-handle { font-size: 15px; color: var(--text-sub); margin-top: 2px; }
        .profile-website { font-size: 14px; margin-top: 6px; }
        .edit-profile-btn { position: absolute; top: 16px; right: 16px; background: var(--bg-card); border: 2px solid var(--point-color); color: var(--point-color); padding: 8px 16px; border-radius: var(--border-radius-btn); font-weight: 700; font-size: 14px; cursor: pointer; transition: all 0.2s; }
        .edit-profile-btn:hover { background: var(--point-color); color: var(--bg-main); }
        .profile-tabs { display: flex; background: var(--bg-card); border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); margin: 10px; overflow: hidden; border: 1px solid var(--border-color); }
        .tab-item { flex: 1; text-align: center; padding: 16px; cursor: pointer; font-weight: 700; color: var(--text-sub); transition: all 0.2s; position: relative; }
        .tab-item.active { color: var(--point-color); }
        .tab-item.active::after { content: ''; position: absolute; bottom: 0; left: 20%; width: 60%; height: 4px; background: var(--point-color); border-radius: 4px 4px 0 0; }
        .media-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; display: none; border-radius: var(--border-radius-card); overflow: hidden; margin: 10px; border: 1px solid var(--border-color); }
        .media-item { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; transition: opacity 0.2s; background: var(--bg-sub); }

        #dm-user-list, #explore-user-list, #admin-user-list { padding: 10px; }
        .user-list-item { background: var(--bg-card); padding: 16px; margin-bottom: 10px; border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); display: flex; align-items: center; justify-content: space-between; cursor: pointer; border: 1px solid var(--border-color); }
        .user-list-img { width: 50px; height: 50px; border-radius: 50%; background: var(--bg-sub); object-fit: cover; margin-right: 12px; border: 2px solid var(--bg-main); }
        .list-badge { background: var(--danger-color); color: var(--text-main); border-radius: 50%; padding: 6px 10px; font-size: 12px; font-weight: 700; display: none; }
        
        #chat-room { display: none; background: var(--bg-main); position: fixed; top: 0; left: 0; width: 100%; height: 100dvh; z-index: 2000; flex-direction: column; }
        .chat-header { background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--bg-sub); padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; }
        [data-theme="light"] .chat-header { background: rgba(255, 255, 255, 0.95); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 10px; }
        .message-bubble { max-width: 75%; padding: 12px 16px; border-radius: 20px; font-size: 15px; position: relative; word-wrap: break-word; box-shadow: var(--shadow-card); }
        .msg-mine { align-self: flex-end; background-color: var(--point-color); color: var(--bg-main); border-bottom-right-radius: 4px; }
        .msg-other { align-self: flex-start; background-color: var(--bg-card); color: var(--text-main); border-bottom-left-radius: 4px; border: 1px solid var(--border-color); }
        .chat-input-area { padding: 12px 16px; padding-bottom: 30px; background: var(--bg-card); border-top: 1px solid var(--border-color); display: flex; gap: 12px; align-items: center; }
        .chat-input { flex: 1; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: var(--border-radius-btn); outline: none; font-size: 15px; background: var(--bg-main); color: var(--text-main); }
        .send-btn-icon { background: none; border: none; color: var(--point-color); font-size: 24px; cursor: pointer; padding: 4px; }
        .leave-chat-btn { background: none; border: none; color: var(--danger-color); font-size: 14px; font-weight: bold; cursor: pointer; }

        .notification-item { background: var(--bg-card); padding: 16px; margin-bottom: 10px; border-radius: var(--border-radius-card); border: 1px solid var(--border-color); display: flex; gap: 12px; cursor: pointer; align-items: flex-start; transition: background-color 0.2s; box-shadow: var(--shadow-card); }
        .notification-item:hover { background-color: var(--bg-sub); }
        .notification-item.unread { background: var(--point-bg-tint); border-left: 4px solid var(--point-color); }
        .noti-icon { font-size: 20px; color: var(--point-color); margin-top: 2px; }
        .noti-preview { font-size: 13px; color: var(--text-sub); margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70vw; }

        .bottom-nav { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 600px; background-color: var(--point-color); border: none; display: flex; justify-content: space-around; padding: 14px 0; z-index: 1000; border-radius: var(--border-radius-btn); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .nav-item { font-size: 28px; cursor: pointer; position: relative; color: var(--nav-icon-color); transition: opacity 0.2s; display: flex; align-items: center; opacity: 0.6; }
        .nav-item:hover, .nav-item.active { opacity: 1; color: var(--nav-icon-color); }
        .nav-badge { position: absolute; top: -4px; right: -6px; background: var(--danger-color); color: white; border-radius: 50%; min-width: 18px; height: 18px; padding: 0 4px; font-size: 11px; line-height: 18px; text-align: center; font-weight: 700; border: 2px solid var(--point-color); display: none; }

        /* [ì¤‘ìš”] ëª¨ë‹¬ í¼ë“¤ (z-index 10000) */
        #auth-form, #edit-profile-form, #reply-modal, #write-modal, #drafts-modal { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 90%; max-width: 400px; background: var(--bg-card); padding: 24px; 
            border-radius: var(--border-radius-card); box-shadow: var(--shadow-card); 
            z-index: 10000; border: 1px solid var(--border-color); 
        }
        .auth-title { font-weight: 800; font-size: 22px; margin-bottom: 20px; text-align: center; color: var(--text-main); }
        .auth-input { width: 100%; margin-bottom: 12px; padding: 12px; border: 1px solid var(--bg-sub); border-radius: 12px; font-size: 15px; outline: none; background: var(--bg-main); color: var(--text-main); }
        .auth-input:focus { border-color: var(--point-color); }
        
        #preview-box, #reply-preview-box, #write-preview-box { display:none; margin: 10px 0; position: relative; }
        .preview-grid { display: grid; gap: 4px; border-radius: 12px; overflow: hidden; max-height: 300px; border: 1px solid var(--border-color); }
        .preview-img { width: 100%; height: 100%; object-fit: cover; background: var(--bg-sub); }
        .remove-img-btn { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6); color: var(--text-main); border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; z-index: 10; }

        .profile-edit-preview { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; display: block; border: 2px solid var(--bg-main); max-width: 100%; max-height: 200px; }

        #scrollTopBtn { display: none; position: fixed; bottom: 85px; right: 20px; z-index: 900; width: 45px; height: 45px; border-radius: 50%; background: var(--bg-card); border: 1px solid var(--border-color); color: var(--point-color); font-size: 24px; cursor: pointer; box-shadow: var(--shadow-card); align-items: center; justify-content: center; }
        @media (min-width: 620px) { #scrollTopBtn { right: calc(50% - 300px + 20px); } }

        .profile-write-fab { position: fixed; bottom: 85px; right: 20px; z-index: 900; width: 55px; height: 55px; border-radius: 50%; background: var(--point-color); color: var(--nav-icon-color); border: none; box-shadow: var(--shadow-card); display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; }
        .draft-item { padding: 12px; border-bottom: 1px solid var(--bg-sub); cursor: pointer; }
        .draft-item:hover { background: var(--bg-sub); }
        .draft-date { font-size: 11px; color: var(--text-sub); margin-top: 4px; }
        
    </style>
</head>
<body>
    <div id="image-modal" class="modal-overlay">
        <span class="close-modal-btn" onclick="closeImageModal()">&times;</span>
        <button class="modal-nav-btn prev-btn" onclick="changeImage(-1)">&#10094;</button>
        <img class="modal-content-img" id="modal-img">
        <button class="modal-nav-btn next-btn" onclick="changeImage(1)">&#10095;</button>
        <div class="modal-counter" id="modal-counter"></div>
    </div>

    <button id="scrollTopBtn" onclick="scrollToTop()">â†‘</button>

    <div id="login-guide">
        <div class="guide-icon">ğŸ”’</div>
        <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
        <p>ê°€ì…í•˜ê³  ë” ë§ì€ ì´ì•¼ê¸°ë¥¼<br>ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”!</p>
        <button onclick="toggleAuth('login')" class="tweet-btn" style="margin:5px;">ë¡œê·¸ì¸</button>
        <button onclick="toggleAuth('signup')" class="tweet-btn btn-gray" style="margin:5px;">íšŒì›ê°€ì…</button>
    </div>

    <div id="write-modal">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h4 style="font-size:18px; color:var(--text-main);">ìƒˆ íŠ¸ìœ—</h4>
            <button onclick="closeWriteModal()" style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);">&times;</button>
        </div>
        <textarea id="writeMsg" maxlength="300" oninput="updateWriteCharCount(this)" placeholder="ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‚˜ìš”?" style="height:100px;"></textarea>
        <div style="text-align:right; margin-bottom:5px;"><span id="writeCharCount" class="char-counter">0/300</span></div>
        <div id="write-preview-box">
            <div id="write-preview-grid" class="preview-grid grid-1"></div>
            <button onclick="removeWriteImages()" class="remove-img-btn">âœ•</button>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <div style="display:flex; gap:10px; align-items:center;">
                <label for="write-file-input" style="cursor: pointer; color: var(--point-color); font-size: 22px;">ğŸ“·</label>
                <input type="file" id="write-file-input" accept="image/*" multiple style="display: none;" onchange="handleWriteFileSelect(this)">
                <button onclick="openDrafts()" style="background:none; border:1px solid var(--text-sub); color:var(--text-sub); padding:4px 8px; border-radius:12px; font-size:12px;">ë³´ê´€í•¨</button>
            </div>
            <div style="display:flex; gap:8px;">
                <button onclick="saveDraft()" style="background:none; border:1px solid var(--point-color); color:var(--point-color); padding:6px 12px; border-radius:99px; font-weight:bold;">ì„ì‹œì €ì¥</button>
                <button id="writeSubmitBtn" class="tweet-btn" onclick="submitNewTweet()">íŠ¸ìœ—í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="drafts-modal">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h4 style="font-size:18px; color:var(--text-main);">ì„ì‹œ ë³´ê´€í•¨ (ìµœëŒ€ 10ê°œ)</h4>
            <button onclick="closeDraftsModal()" style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);">&times;</button>
        </div>
        <div id="drafts-list" style="max-height:300px; overflow-y:auto;"></div>
    </div>

    <div id="reply-modal">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h4 style="font-size:18px; color:var(--text-main);">ë‹µê¸€ ë‹¬ê¸°</h4>
            <button onclick="closeReplyModal()" style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);">&times;</button>
        </div>
        <div style="margin-bottom:10px; color:var(--text-sub); font-size:14px;">
            Reply to <span id="reply-target-name" style="color:var(--point-color); font-weight:bold;">@User</span>
        </div>
        <textarea id="replyMsg" maxlength="300" oninput="updateReplyCharCount(this)" placeholder="ë‹µê¸€ì„ ê²Œì‹œí•˜ì„¸ìš”" style="height:100px;"></textarea>
        <div style="text-align:right; margin-bottom:5px;"><span id="replyCharCount" class="char-counter">0/300</span></div>
        <div id="reply-preview-box">
            <div id="reply-preview-grid" class="preview-grid grid-1"></div>
            <button onclick="removeReplyImages()" class="remove-img-btn">âœ•</button>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <label for="reply-file-input" style="cursor: pointer; color: var(--point-color); font-size: 22px;">ğŸ“·</label>
            <input type="file" id="reply-file-input" accept="image/*" multiple style="display: none;" onchange="handleReplyFileSelect(this)">
            <button id="replySubmitBtn" class="tweet-btn" onclick="submitReply()">ë‹µê¸€</button>
        </div>
    </div>

    <div id="auth-form">
        <h4 id="auth-title" class="auth-title">ë¡œê·¸ì¸</h4>
        <input type="text" id="handleInput" class="auth-input" placeholder="ì•„ì´ë”” (ì˜ë¬¸,ìˆ«ì)" style="display:none;" oninput="this.value = this.value.replace(/[^a-zA-Z0-9_]/g, '').toLowerCase()">
        <input type="text" id="nickNameInput" class="auth-input" placeholder="ë‹‰ë„¤ì„ (ì´ë¦„)" style="display:none;">
        <input type="text" id="inviteCodeInput" class="auth-input" placeholder="ì´ˆëŒ€ ì½”ë“œ (ë¹„ë°€ë²ˆí˜¸: 1234)" style="display:none;">
        
        <input type="email" id="emailInput" class="auth-input" placeholder="ì´ë©”ì¼">
        <input type="password" id="pwInput" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button id="submitAuthBtn" class="full-btn btn-blue">í™•ì¸</button>
        <button onclick="toggleAuth('close')" class="full-btn btn-gray">ì·¨ì†Œ</button>
    </div>
    
    <div id="edit-profile-form">
        <h4 class="auth-title">í”„ë¡œí•„ ìˆ˜ì •</h4>
        <img id="editProfilePreview" src="" class="profile-edit-preview">
        <label for="profile-file-input" class="file-upload-label" style="display:block; text-align:center; color:var(--point-color); margin-bottom:20px; cursor:pointer;">ğŸ“· ì‚¬ì§„ ë³€ê²½í•˜ê¸°</label>
        <input type="file" id="profile-file-input" accept="image/*" style="display:none;" onchange="handleProfileFileSelect(this)">
        <input type="text" id="editBioInput" class="auth-input" placeholder="ìê¸°ì†Œê°œ (í•œì¤„)">
        <input type="url" id="editLinkInput" class="auth-input" placeholder="ë§í¬ (https://...)">
        <button id="saveProfileBtn" onclick="saveProfile()" class="full-btn btn-blue" style="margin-bottom:10px;">ì €ì¥í•˜ê¸°</button>
        <button onclick="withdrawUser()" class="full-btn btn-danger" style="margin-bottom:10px;">íšŒì› íƒˆí‡´</button>
        <button onclick="toggleEditProfile()" class="full-btn btn-gray">ì·¨ì†Œ</button>
    </div>

    <div id="main-page" class="page active">
        <div class="header">
            <div class="header-content">
                <span class="header-title">ë‚˜ì˜ íŠ¸ìœ„í„°</span>
                <div id="auth-buttons">
                    <button onclick="toggleAuth('login')" class="tweet-btn">ë¡œê·¸ì¸</button>
                    <button onclick="toggleAuth('signup')" class="tweet-btn btn-gray" style="margin-left: 8px;">íšŒì›ê°€ì…</button>
                </div>
                <div id="user-info" style="display:none; align-items: center; gap: 10px; cursor: pointer;" onclick="toggleUserMenu()">
                    <div style="text-align: right;">
                        <span id="userNameDisplay" style="font-size: 15px; font-weight: 700; display: block; color:var(--text-main);"></span>
                        <span id="userHandleDisplay" style="font-size: 12px; color: var(--text-sub); display: block;"></span>
                    </div>
                    <img id="myProfileSmall" src="" class="profile-pic">
                </div>
                <div id="user-menu-dropdown">
                    <div class="menu-item" onclick="goToMyProfile()">ğŸ‘¤ ë‚´ í”„ë¡œí•„</div>
                    <div id="admin-menu-item" class="menu-item" style="display:none; color:var(--point-color);" onclick="goToAdminPage()">ğŸ‘‘ ê´€ë¦¬ì í˜ì´ì§€</div>
                    <div class="menu-item" onclick="toggleTheme()">ğŸŒ“ í…Œë§ˆ ë³€ê²½</div>
                    <div class="menu-item danger" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</div>
                </div>
            </div>
        </div>
        <div class="feed">
            <div class="tweet-input-box" id="tweetInputArea" style="display:none;">
                <textarea id="tweetMsg" maxlength="300" oninput="updateCharCount(this)" placeholder="ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‚˜ìš”? (@ì•„ì´ë”” ë¡œ íƒœê·¸í•´ë³´ì„¸ìš”)"></textarea>
                <div id="preview-box">
                    <div id="preview-grid" class="preview-grid grid-1"></div>
                    <button onclick="removeImages()" class="remove-img-btn">âœ•</button>
                </div>
                <div class="storage-bar-container"><div id="storageBarFill" class="storage-bar-fill"></div></div>
                <div class="storage-text" id="storageTextDetail">ìš©ëŸ‰ ì²´í¬ ì¤‘...</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                    <div style="display:flex; align-items:center;">
                        <label for="file-input" style="cursor: pointer; color: var(--point-color); font-size: 22px; padding: 8px;">ğŸ“·</label>
                        <input type="file" id="file-input" accept="image/*" multiple style="display: none;" onchange="handleFileSelect(this)">
                        <button onclick="openDrafts()" style="margin-left:10px; background:none; border:1px solid var(--text-sub); color:var(--text-sub); padding:4px 8px; border-radius:12px; font-size:12px;">ë³´ê´€í•¨</button>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <span id="charCount" class="char-counter">0/300</span>
                        <button id="tweetBtn" class="tweet-btn" onclick="addTweet()">íŠ¸ìœ—í•˜ê¸°</button>
                    </div>
                </div>
            </div>
            
            <div id="tweet-list"></div>
        </div>
    </div>

    <div id="detail-page" class="page"><div class="header"><div class="header-content" style="justify-content: flex-start; gap: 20px;"><button onclick="goToPage('main')" style="background:none; border:none; font-size:24px; cursor:pointer; color:var(--text-main);">â†</button><span class="header-title">íŠ¸ìœ—</span></div></div><div class="feed" id="detail-feed" style="padding-top:10px;"></div></div>
    <div id="noti-page" class="page"><div class="header"><div class="header-content"><span class="header-title">ì•Œë¦¼</span></div></div><div id="noti-list" class="feed" style="padding: 10px;"><div style="padding: 30px; text-align: center; color: var(--text-sub);">ë¡œë”© ì¤‘...</div></div></div>
    
    <div id="dm-page" class="page">
        <div class="header"><div class="header-content"><span class="header-title">ë©”ì‹œì§€</span></div></div>
        <div id="dm-user-list" style="padding: 10px;"><div style="padding: 30px; text-align: center; color: var(--text-sub);">ë¡œë”© ì¤‘...</div></div>
    </div>
    
    <div id="explore-page" class="page"><div class="header"><div class="header-content"><span class="header-title">íƒìƒ‰</span></div></div><div id="explore-user-list" style="padding: 10px;"><div style="padding: 30px; text-align: center; color: var(--text-sub);">ë¡œë”© ì¤‘...</div></div></div>

    <div id="profile-page" class="page">
        <div class="profile-banner"></div>
        <div class="profile-header">
            <button id="editProfileBtn" class="edit-profile-btn" onclick="toggleEditProfile()" style="display:none;">í”„ë¡œí•„ ìˆ˜ì •</button>
            <img id="profilePageImg" src="" class="profile-img-large" onclick="openImageModal([this.src], 0)">
            <div id="profilePageName" class="profile-name">ì´ë¦„</div>
            <div id="profilePageHandle" class="profile-handle">@id</div>
            <div id="profilePageBio" class="profile-bio">ìê¸°ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            <div id="profilePageLink" class="profile-website"></div>
            <div class="profile-stats" style="color:var(--text-main); margin-top:10px;"><span><strong id="myTweetCount">0</strong> íŠ¸ìœ—</span><span style="margin-left: 10px;"><strong id="myMediaCount">0</strong> ë¯¸ë””ì–´</span></div>
        </div>
        <div class="profile-tabs">
            <div class="tab-item active" onclick="switchTab('tweets')">íŠ¸ìœ—</div>
            <div class="tab-item" onclick="switchTab('media')">ë¯¸ë””ì–´</div>
            <div class="tab-item" onclick="switchTab('keeps')">Keep</div>
        </div>
        <div class="feed">
            <div id="my-tweet-list"></div>
            <div id="my-media-grid" class="media-grid"></div>
            <div id="my-keep-list" style="display:none;"></div>
        </div>
        <button id="profileWriteBtn" class="profile-write-fab" onclick="openWriteModal()" style="display:none;"><i class="ph ph-pen-nib"></i></button>
    </div>
    
    <div id="admin-page" class="page">
        <div class="header"><div class="header-content" style="justify-content: flex-start; gap: 20px;"><button onclick="goToPage('main')" style="background:none; border:none; font-size:24px; cursor:pointer; color:var(--text-main);">â†</button><span class="header-title">íšŒì› ê´€ë¦¬</span></div></div>
        <div id="admin-user-list" style="padding: 10px;"><div style="padding: 30px; text-align: center; color: var(--text-sub);">ë¡œë”© ì¤‘...</div></div>
    </div>

    <div id="chat-room">
        <div class="chat-header">
            <button class="back-btn" onclick="closeChat()" style="background:none; border:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right:10px;">â†</button>
            <span id="chatTargetName" style="font-weight: 800; font-size: 18px; color:var(--text-main);">ìƒëŒ€ë°©</span>
            <button class="leave-chat-btn" onclick="leaveChat()">ë‚˜ê°€ê¸°</button>
        </div>
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input-area" id="chatInputArea">
            <input type="text" id="chatInput" class="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeypress="if(event.keyCode==13) sendMsg()">
            <button class="send-btn-icon" onclick="sendMsg()">ğŸ“¤</button>
        </div>
        <div id="admin-banner" class="admin-surveillance-banner" style="display:none;">ê´€ë¦¬ì ê°ì²­ ëª¨ë“œì…ë‹ˆë‹¤ (ëŒ€í™” ë¶ˆê°€)</div>
    </div>

    <div class="bottom-nav" id="bottomNav">
        <div class="nav-item active" onclick="goToPage('main')"><i class="ph ph-house"></i></div>
        <div class="nav-item" onclick="goToPage('explore')"><i class="ph ph-users"></i></div>
        <div class="nav-item" onclick="goToPage('noti')"><i class="ph ph-bell"></i><div id="noti-badge" class="nav-badge">0</div></div>
        <div class="nav-item" onclick="goToPage('dm')"><i class="ph ph-paper-plane-right"></i><div id="dm-badge" class="nav-badge">0</div></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, getDoc, setDoc, updateDoc, increment, deleteDoc, where, getDocs, deleteField, limit, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // ==========================================
        // [ì„¤ì •] ë³¸ì¸ firebaseConfig ë¶™ì—¬ë„£ê¸°
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyABbDbOIrcNq-2SalkWsVRlFZRrPWXu0Sw", 
            authDomain: "my-twitter-commu.firebaseapp.com",
            projectId: "my-twitter-commu",
            storageBucket: "my-twitter-commu.firebasestorage.app",
            messagingSenderId: "612531867322",
            appId: "1:612531867322:web:c56e42c09d060d4a2fbc83"
        };
        // ==========================================

        const ADMIN_EMAIL = "yw3016@naver.com"; 
        const INVITE_CODE = "1234";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const MAX_STORAGE_BYTES = 150 * 1024 * 1024;

        let currentUserData = { usedStorage: 0 };
        let selectedFiles = []; let selectedReplyFiles = []; let selectedWriteFiles = [];
        let selectedProfileFile = null;
        let isSignupMode = false;
        let currentChatId = null; let currentTargetUid = null; let unsubscribeChat = null; 
        let myUnreadMap = {}; let allUsersCache = {}; let tweetSnapshotCache = null;
        let currentReplyParentId = null; let currentReplyParentUid = null;
        let currentGalleryImages = []; let currentGalleryIndex = 0;
        let allTweetsMap = {}; let currentProfileUid = null;

        window.goToMyProfile = () => { if (auth.currentUser) goToUserProfile(auth.currentUser.uid); }
        window.updateCharCount = (textarea) => { const c = textarea.value.length; const el = document.getElementById('charCount'); el.innerText = `${c}/300`; if(c>300) el.classList.add('warning'); else el.classList.remove('warning'); }
        window.updateReplyCharCount = (textarea) => { const c = textarea.value.length; const el = document.getElementById('replyCharCount'); el.innerText = `${c}/300`; if(c>300) el.classList.add('warning'); else el.classList.remove('warning'); }
        window.updateWriteCharCount = (textarea) => { const c = textarea.value.length; const el = document.getElementById('writeCharCount'); el.innerText = `${c}/300`; if(c>300) el.classList.add('warning'); else el.classList.remove('warning'); }
        
        window.onscroll = () => { const btn = document.getElementById("scrollTopBtn"); if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) btn.style.display = "flex"; else btn.style.display = "none"; };
        window.scrollToTop = () => { window.scrollTo({ top: 0, behavior: 'smooth' }); };
        window.toggleTheme = () => { const b = document.body; if (b.getAttribute('data-theme') === 'light') { b.removeAttribute('data-theme'); localStorage.setItem('theme', 'dark'); } else { b.setAttribute('data-theme', 'light'); localStorage.setItem('theme', 'light'); } toggleUserMenu(); };
        if (localStorage.getItem('theme') === 'light') document.body.setAttribute('data-theme', 'light');
        window.toggleUserMenu = () => { const m = document.getElementById('user-menu-dropdown'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; };
        window.logout = () => { signOut(auth).then(() => window.location.reload()); };
        
        window.openImageModal = (imgs, idx) => { currentGalleryImages = imgs; currentGalleryIndex = idx; document.getElementById('image-modal').style.display = "flex"; updateModalImage(); }
        function updateModalImage() { document.getElementById('modal-img').src = currentGalleryImages[currentGalleryIndex]; document.getElementById('modal-counter').innerText = `${currentGalleryIndex+1} / ${currentGalleryImages.length}`; }
        window.changeImage = (s) => { let n = currentGalleryIndex + s; if(n < 0) n = currentGalleryImages.length-1; if(n >= currentGalleryImages.length) n = 0; currentGalleryIndex = n; updateModalImage(); }
        window.closeImageModal = () => document.getElementById('image-modal').style.display = "none";

        function getDrafts() { return JSON.parse(localStorage.getItem('my_twitter_drafts') || "[]"); }
        function setDrafts(drafts) { localStorage.setItem('my_twitter_drafts', JSON.stringify(drafts)); }
        window.saveDraft = () => { const content = document.getElementById('writeMsg').value; if(!content.trim()) return alert("ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤."); let drafts = getDrafts(); if(drafts.length >= 10) return alert("ê½‰ ì°¸ (ìµœëŒ€ 10ê°œ)."); drafts.unshift({ content: content, date: new Date().toLocaleString() }); setDrafts(drafts); alert("ì €ì¥ë¨"); document.getElementById('writeMsg').value = ""; document.getElementById('writeCharCount').innerText = "0/300"; }
        window.openDrafts = () => { const modal = document.getElementById('drafts-modal'); const list = document.getElementById('drafts-list'); list.innerHTML = ""; const drafts = getDrafts(); if(drafts.length === 0) list.innerHTML = "<div style='padding:20px; text-align:center; color:var(--text-sub)'>ë³´ê´€ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; else { drafts.forEach((d, idx) => { const div = document.createElement('div'); div.className = 'draft-item'; div.innerHTML = `<div>${d.content.substring(0,30)}${d.content.length>30?'...':''}</div><div class="draft-date">${d.date}</div>`; div.onclick = () => { document.getElementById('writeMsg').value = d.content; window.updateWriteCharCount(document.getElementById('writeMsg')); drafts.splice(idx, 1); setDrafts(drafts); closeDraftsModal(); }; list.appendChild(div); }); } modal.style.display = 'block'; }
        window.closeDraftsModal = () => { document.getElementById('drafts-modal').style.display = 'none'; }

        window.openWriteModal = () => { document.getElementById('write-modal').style.display = 'block'; }
        window.closeWriteModal = () => { document.getElementById('write-modal').style.display = 'none'; document.getElementById('writeMsg').value = ""; removeWriteImages(); }
        window.handleWriteFileSelect = (inp) => handleFiles(inp, 'write-preview-grid', 'write-preview-box', f=>selectedWriteFiles=f);
        window.removeWriteImages = () => { selectedWriteFiles=[]; document.getElementById('write-file-input').value=""; document.getElementById('write-preview-box').style.display='none'; }
        window.submitNewTweet = async () => { const text = document.getElementById('writeMsg').value; const user = auth.currentUser; if(!text && selectedWriteFiles.length === 0) return; if(text.length > 300) return alert("300ì ì´ˆê³¼"); const btn = document.getElementById('writeSubmitBtn'); btn.disabled = true; btn.innerText = "..."; try { let urls = []; if(selectedWriteFiles.length > 0) { const promises = selectedWriteFiles.map(async (f) => { const s = await uploadBytes(ref(storage, 'images/'+Date.now()+'_'+user.uid), f); return getDownloadURL(s.ref); }); urls = await Promise.all(promises); await updateDoc(doc(db,"users",user.uid), {usedStorage: increment(selectedWriteFiles.reduce((a,b)=>a+b.size,0))}); } await addDoc(collection(db,"tweets"), {content:text, imageUrls:urls, date:new Date().toISOString(), uid:user.uid, name:user.displayName, profilePic:user.photoURL, keptBy:[]}); closeWriteModal(); alert("ê²Œì‹œë¨"); } catch(e) { console.error(e); } finally { btn.disabled = false; btn.innerText = "íŠ¸ìœ—í•˜ê¸°"; } }

        const allUsersQuery = query(collection(db, "users"));
        onSnapshot(allUsersQuery, (snap) => { snap.forEach(d => allUsersCache[d.id] = d.data()); if(tweetSnapshotCache && auth.currentUser) renderTimeline(tweetSnapshotCache); });

        window.toggleAuth = (mode) => {
            const form = document.getElementById('auth-form');
            if (mode === 'close') { form.style.display = 'none'; return; }
            form.style.display = 'block';
            isSignupMode = (mode === 'signup');
            document.getElementById('auth-title').innerText = isSignupMode ? "íšŒì›ê°€ì…" : "ë¡œê·¸ì¸";
            document.getElementById('nickNameInput').style.display = isSignupMode ? 'block' : 'none';
            document.getElementById('handleInput').style.display = isSignupMode ? 'block' : 'none';
            document.getElementById('inviteCodeInput').style.display = isSignupMode ? 'block' : 'none';
        };

        onAuthStateChanged(auth, async (user) => {
            const authBtns = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const inputBox = document.getElementById('tweetInputArea');
            const bottomNav = document.getElementById('bottomNav');
            const loginGuide = document.getElementById('login-guide');
            const tweetList = document.getElementById('tweet-list');
            const feedContainer = document.querySelector('.feed');

            if (user) {
                // ë¡œê·¸ì¸ ì‹œ ë¸”ëŸ¬ í•´ì œ
                document.body.classList.remove('scroll-locked');
                tweetList.classList.remove('blur-mode');

                const userRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(userRef);
                
                if (!docSnap.exists()) {
                    await setDoc(userRef, { email: user.email, name: user.displayName, photoURL: user.photoURL, usedStorage: 0, bio: "", unread: {}, handle: user.email.split('@')[0], website: "", isApproved: true });
                }

                authBtns.style.display = 'none'; userInfo.style.display = 'flex'; inputBox.style.display = 'block'; bottomNav.style.display = 'flex';
                loginGuide.style.display = 'none'; tweetList.style.display = 'block';
                document.getElementById('userNameDisplay').innerText = user.displayName;
                document.getElementById('myProfileSmall').src = user.photoURL || "https://via.placeholder.com/40";
                
                if(user.email === ADMIN_EMAIL) document.getElementById('admin-menu-item').style.display = 'block';
                else document.getElementById('admin-menu-item').style.display = 'none';

                onSnapshot(userRef, (d) => { if(d.exists()) { currentUserData = d.data(); document.getElementById('userHandleDisplay').innerText = "@"+(currentUserData.handle||""); myUnreadMap = currentUserData.unread || {}; updateBadgeUI(); } });
                loadNotifications(user.uid);
                
                // íƒ€ì„ë¼ì¸ ë¡œë“œ
                const q = query(collection(db, "tweets"), orderBy("date", "desc"));
                onSnapshot(q, (snapshot) => { tweetSnapshotCache = snapshot; renderTimeline(snapshot); });

            } else {
                // ë¡œê·¸ì•„ì›ƒ ì‹œ ë¸”ëŸ¬ ì ìš© ë° ë”ë¯¸ ë°ì´í„° í‘œì‹œ
                authBtns.style.display = 'block'; userInfo.style.display = 'none'; inputBox.style.display = 'none'; bottomNav.style.display = 'none';
                loginGuide.style.display = 'block'; tweetList.style.display = 'block';
                
                document.body.classList.add('scroll-locked');
                tweetList.classList.add('blur-mode');
                tweetList.innerHTML = `
                    <div class="tweet single"><div class="tweet-left"><div class="profile-pic" style="background-color:var(--bg-sub)"></div></div><div class="content"><h4>User <span class="user-handle">@user</span></h4><p>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ</p></div></div>
                    <div class="tweet single"><div class="tweet-left"><div class="profile-pic" style="background-color:var(--bg-sub)"></div></div><div class="content"><h4>User <span class="user-handle">@user</span></h4><p>â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</p></div></div>
                    <div class="tweet single"><div class="tweet-left"><div class="profile-pic" style="background-color:var(--bg-sub)"></div></div><div class="content"><h4>User <span class="user-handle">@user</span></h4><p>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</p></div></div>
                `;
                goToPage('main');
            }
        });

        function renderTimeline(snap) { const l=document.getElementById('tweet-list'); l.innerHTML=""; const me=auth.currentUser; allTweetsMap={}; snap.forEach(d=>{ allTweetsMap[d.id]={id:d.id, ...d.data()}; }); snap.forEach(d=>{ const dt=d.data(); const mine=me&&dt.uid===me.uid; if(dt.parentId){ const rt=findRoot(dt.parentId); if(rt){ const rh=createTweetHTML(rt,rt.id,false,false,'root',true); const mh=createTweetHTML(dt,d.id,mine,false,'main',false); l.insertAdjacentHTML('beforeend', `<div class="thread-group">${rh}<div class="thread-connector"></div>${mh}</div>`); } else l.insertAdjacentHTML('beforeend', createTweetHTML(dt,d.id,mine,false)); } else l.insertAdjacentHTML('beforeend', createTweetHTML(dt,d.id,mine,false,'single')); }); }
        function findRoot(pid){ const p=allTweetsMap[pid]; if(!p)return null; if(!p.parentId)return p; return findRoot(p.parentId); }
        function createTweetHTML(d,id,mine,foc,type='single',conn=false,dep=0){ 
            if(d.isDeleted) return `<div class="tweet deleted"><div class="content"><p>ğŸ—‘ ì‚­ì œëœ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p></div></div>`;
            const u=allUsersCache[d.uid]||{name:d.name, handle:"unknown", photoURL:d.profilePic};
            const img=d.imageUrls?`<div class="tweet-img-grid grid-${Math.min(d.imageUrls.length,4)}">${d.imageUrls.map((u,i)=>`<img src="${u}" class="tweet-img-item" onclick="openImageModal(['${d.imageUrls}'],${i});event.stopPropagation()">`).join('')}</div>`:'';
            const del=mine?`<button class="delete-btn" onclick="deleteTweet('${id}','${JSON.stringify(d.imageUrls||[])}',${d.imageSize||0});event.stopPropagation()">â‹®</button>`:'';
            const cls=foc?'focus-tweet':''; const c_cls=conn?'has-child':''; let ln="";
            if(type==='root')ln=`<div class="thread-line-down" style="display:block"></div>`;
            if(type==='main')ln=`<div class="thread-line-up" style="display:block"></div>`;
            if(type==='child')ln=`<div class="thread-line-up" style="display:block"></div>`+(conn?`<div class="thread-line-down" style="display:block"></div>`:"");
            let ind=""; if(type==='child') ind=`padding-left:${Math.min(dep,3)*20}px`;
            const k=d.keptBy?d.keptBy.length:0; const ik=auth.currentUser&&d.keptBy&&d.keptBy.includes(auth.currentUser.uid)?'active-keep':''; const iw=ik?'fill':'regular';
            return `<div class="tweet ${type} ${cls} ${c_cls}" onclick="goToTweetDetail('${id}')" style="${ind}"><div class="tweet-left"><div class="profile-pic" style="background-image:url(${u.photoURL||'https://via.placeholder.com/40'});background-size:cover;"></div>${ln}</div><div class="content"><h4>${u.name} <span class="user-handle">@${u.handle}</span></h4><p>${d.content}</p>${img}<div class="tweet-actions"><button class="action-btn" onclick="openReplyModal('${id}','${u.handle}','${d.uid}');event.stopPropagation()">ğŸ’¬</button><button class="action-btn ${ik}" onclick="toggleKeep('${id}');event.stopPropagation()"><i class="ph-${iw} ph-hand-palm" style="font-size:18px;"></i> ${k>0?k:''}</button></div></div>${del}</div>`;
        }
        window.handleFileSelect=(i)=>handleFiles(i,'preview-grid','preview-box',f=>selectedFiles=f);
        window.handleReplyFileSelect=(i)=>handleFiles(i,'reply-preview-grid','reply-preview-box',f=>selectedReplyFiles=f);
        function handleFiles(inp,g,b,s){ if(inp.files){ s(Array.from(inp.files)); document.getElementById(b).style.display='block'; } }
        window.removeImages=()=>{ selectedFiles=[]; document.getElementById('preview-box').style.display='none'; }
        window.removeReplyImages=()=>{ selectedReplyFiles=[]; document.getElementById('reply-preview-box').style.display='none'; }
        window.deleteTweet=async(id,urls,sz)=>{ if(confirm("ì‚­ì œ?")){ await updateDoc(doc(db,"tweets",id),{isDeleted:true, content:"", imageUrls:[]}); } }

        window.goToUserProfile = (targetUid) => {
            currentProfileUid = targetUid;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('profile-page').classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(document.getElementById('user-menu-dropdown').style.display === 'block') toggleUserMenu();

            const user = allUsersCache[targetUid];
            const isMe = (auth.currentUser && targetUid === auth.currentUser.uid);

            document.getElementById('profilePageName').innerText = user.name;
            document.getElementById('profilePageHandle').innerText = "@" + (user.handle || "unknown");
            document.getElementById('profilePageImg').src = user.photoURL ? user.photoURL : "https://via.placeholder.com/80";
            document.getElementById('profilePageBio').innerText = user.bio || "ìê¸°ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤.";
            const linkDiv = document.getElementById('profilePageLink');
            if(user.website) { linkDiv.innerHTML = `<a href="${user.website}" target="_blank" class="link-text">ğŸ”— ${user.website}</a>`; } else { linkDiv.innerHTML = ""; }

            document.getElementById('editProfileBtn').style.display = isMe ? 'block' : 'none';
            document.getElementById('profileWriteBtn').style.display = isMe ? 'flex' : 'none';

            if(isMe) {
                document.getElementById('editProfilePreview').src = user.photoURL ? user.photoURL : "https://via.placeholder.com/80";
                document.getElementById('editBioInput').value = user.bio || "";
                document.getElementById('editLinkInput').value = user.website || "";
            }

            switchTab('tweets'); 
        }

        window.toggleEditProfile = () => { const f = document.getElementById('edit-profile-form'); f.style.display = f.style.display === 'none' ? 'block' : 'none'; }
        window.handleProfileFileSelect = (input) => { if (input.files && input.files[0]) { selectedProfileFile = input.files[0]; const reader = new FileReader(); reader.onload = (e) => document.getElementById('editProfilePreview').src = e.target.result; reader.readAsDataURL(selectedProfileFile); } }
        window.saveProfile = async () => { const bio = document.getElementById('editBioInput').value; const link = document.getElementById('editLinkInput').value; const user = auth.currentUser; const btn = document.getElementById('saveProfileBtn'); btn.innerText = "..."; btn.disabled = true; try { let updateData = { bio: bio, website: link }; if (selectedProfileFile) { const snap = await uploadBytes(ref(storage, 'profiles/' + user.uid), selectedProfileFile); const url = await getDownloadURL(snap.ref); await updateProfile(user, { photoURL: url }); updateData.photoURL = url; document.getElementById('profilePageImg').src = url; document.getElementById('myProfileSmall').src = url; } await updateDoc(doc(db, "users", user.uid), updateData); document.getElementById('profilePageBio').innerText = bio; const linkDiv = document.getElementById('profilePageLink'); if(link) { linkDiv.innerHTML = `<a href="${link}" target="_blank" class="link-text">ğŸ”— ${link}</a>`; } else { linkDiv.innerHTML = ""; } alert("ì™„ë£Œ!"); toggleEditProfile(); } catch (e) { alert("ì‹¤íŒ¨"); } finally { btn.innerText = "ì €ì¥í•˜ê¸°"; btn.disabled = false; } }
        
        window.switchTab = (tab) => {
            const items = document.querySelectorAll('.tab-item');
            const tweetList = document.getElementById('my-tweet-list');
            const mediaGrid = document.getElementById('my-media-grid');
            const keepList = document.getElementById('my-keep-list');
            items.forEach(i => i.classList.remove('active'));
            tweetList.style.display = 'none'; mediaGrid.style.display = 'none'; keepList.style.display = 'none';
            if(tab === 'tweets') { items[0].classList.add('active'); tweetList.style.display = 'block'; loadProfileContent(currentProfileUid, 'tweets'); } 
            else if(tab === 'media') { items[1].classList.add('active'); mediaGrid.style.display = 'grid'; loadProfileContent(currentProfileUid, 'media'); } 
            else if(tab === 'keeps') { items[2].classList.add('active'); keepList.style.display = 'block'; loadProfileContent(currentProfileUid, 'keeps'); } 
        }

        function loadProfileContent(uid, type) { 
            const tweetList = document.getElementById('my-tweet-list'); 
            const mediaGrid = document.getElementById('my-media-grid'); 
            const keepList = document.getElementById('my-keep-list'); 
            tweetList.innerHTML = ""; mediaGrid.innerHTML = ""; keepList.innerHTML = "";
            let q; 
            if (type === 'keeps') { q = query(collection(db, "tweets"), where("keptBy", "array-contains", uid), orderBy("date", "desc")); } 
            else { q = query(collection(db, "tweets"), where("uid", "==", uid), orderBy("date", "desc")); } 
            onSnapshot(q, (s) => { 
                if (type === 'tweets') { 
                    if(s.empty) { tweetList.innerHTML = "<div style='padding:20px; text-align:center; color:var(--text-sub)'>ì‘ì„±í•œ íŠ¸ìœ—ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; document.getElementById('myTweetCount').innerText = 0; }
                    else {
                        document.getElementById('myTweetCount').innerText = s.size; 
                        tweetList.innerHTML = ""; 
                        s.forEach((doc) => { const data = doc.data(); tweetList.insertAdjacentHTML('beforeend', createTweetHTML(data, doc.id, true, false)); }); 
                    }
                } else if (type === 'media') { 
                    mediaGrid.innerHTML = ""; let mCount = 0; 
                    s.forEach((doc) => { const data = doc.data(); if(data.imageUrls) { data.imageUrls.forEach(u => { mCount++; mediaGrid.insertAdjacentHTML('beforeend', `<img src="${u}" class="media-item" onclick="openImageModal(['${u}'],0)">`); }); } else if(data.imageUrl) { mCount++; mediaGrid.insertAdjacentHTML('beforeend', `<img src="${data.imageUrl}" class="media-item" onclick="openImageModal(['${data.imageUrl}'],0)">`); } }); 
                    document.getElementById('myMediaCount').innerText = mCount; 
                    if(mCount === 0) mediaGrid.style.display = 'none';
                } else if (type === 'keeps') { 
                    if(s.empty) keepList.innerHTML = "<div style='padding:20px; text-align:center; color:var(--text-sub)'>Keepí•œ íŠ¸ìœ—ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
                    else {
                        keepList.innerHTML = "";
                        s.forEach((doc) => { const data = doc.data(); keepList.insertAdjacentHTML('beforeend', createTweetHTML(data, doc.id, false, false)); }); 
                    }
                } 
            }); 
        }

        // --- ê´€ë¦¬ì ê¸°ëŠ¥ ---
        window.goToAdminPage = () => {
            if (auth.currentUser.email !== ADMIN_EMAIL) return alert("ê¶Œí•œ ì—†ìŒ");
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('admin-page').classList.add('active');
            loadAdminUserList(); toggleUserMenu();
        }
        async function loadAdminUserList() {
            const listDiv = document.getElementById('admin-user-list');
            listDiv.innerHTML = "ë¡œë”© ì¤‘...";
            const usersSnap = await getDocs(collection(db, "users"));
            listDiv.innerHTML = "";
            let count = 0;
            usersSnap.forEach(doc => {
                const data = doc.data();
                if (data.email === ADMIN_EMAIL) return;
                count++;
                const btnHtml = `<button class="delete-user-btn" onclick="adminDeleteUser('${doc.id}')">ê°•ì œ íƒˆí‡´</button>`;
                const html = `<div class="user-list-item"><div style="display:flex; align-items:center;"><img src="${data.photoURL || 'https://via.placeholder.com/40'}" class="user-list-img"><div><div class="user-name-bold">${data.name}</div><div style="font-size:12px; color:var(--text-sub);">${data.email}</div></div></div>${btnHtml}</div>`;
                listDiv.insertAdjacentHTML('beforeend', html);
            });
            if (count === 0) listDiv.innerHTML = "<div style='text-align:center; padding:20px; color:var(--text-sub)'>íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
        }
        window.adminDeleteUser = async (uid) => { if(!confirm("ê°•ì œ íƒˆí‡´? (ë³µêµ¬ ë¶ˆê°€)")) return; await deleteUserData(uid); alert("ì‚­ì œë¨"); loadAdminUserList(); }

        async function deleteUserData(uid) {
            const tweetsQ = query(collection(db, "tweets"), where("uid", "==", uid));
            const tweetsSnap = await getDocs(tweetsQ);
            tweetsSnap.forEach(async (d) => { const data = d.data(); if (data.imageUrls) { data.imageUrls.forEach(url => deleteObject(ref(storage, url)).catch(()=>{})); } await updateDoc(d.ref, { isDeleted: true, content: "", imageUrls: [], imageSize: 0 }); });
            try { await deleteObject(ref(storage, `profiles/${uid}`)); } catch(e) {}
            await deleteDoc(doc(db, "users", uid));
        }

        window.withdrawUser = async () => { if(!confirm("ì •ë§ íƒˆí‡´?")) return; const user = auth.currentUser; const uid = user.uid; try { await deleteUserData(uid); await deleteUser(user); alert("íƒˆí‡´ ì™„ë£Œ"); window.location.reload(); } catch (e) { alert("ì˜¤ë¥˜: " + e.message); } }

        // --- ì±„íŒ…ë°© ëª©ë¡ (ê´€ë¦¬ì ê°ì²­ ë¡œì§ í¬í•¨) ---
        async function loadAllChatList() {
            const listDiv = document.getElementById('dm-user-list'); 
            const myUid = auth.currentUser ? auth.currentUser.uid : null; 
            const myEmail = auth.currentUser ? auth.currentUser.email : null;
            if(!myUid) return; 
            listDiv.innerHTML = "";
            
            let q;
            if (myEmail === ADMIN_EMAIL) {
                q = query(collection(db, "chats"), orderBy("updatedAt", "desc"));
            } else {
                q = query(collection(db, "chats"), where("participants", "array-contains", myUid), orderBy("updatedAt", "desc"));
            }
            
            const snapshot = await getDocs(q);
            if (snapshot.empty) { listDiv.innerHTML = "<div style='text-align:center; padding:20px; color:var(--text-sub)'>ëŒ€í™” ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }

            snapshot.forEach(doc => {
                const data = doc.data();
                if (myEmail !== ADMIN_EMAIL && data.deletedBy && data.deletedBy.includes(myUid)) return;
                
                let roomName = data.groupName;
                let roomImg = "https://via.placeholder.com/40"; 

                if (data.participants.length === 2 && !data.type) {
                    const otherUid = data.participants.find(uid => uid !== myUid);
                    if (otherUid && allUsersCache[otherUid]) {
                        roomName = allUsersCache[otherUid].name;
                        roomImg = allUsersCache[otherUid].photoURL || roomImg;
                    }
                } else if (data.type === 'group') {
                    roomImg = "https://via.placeholder.com/40?text=G"; 
                }

                const adminBadge = (myEmail === ADMIN_EMAIL && !data.participants.includes(myUid)) ? " <span style='color:var(--point-color); font-size:11px;'>(ê°ì²­)</span>" : "";

                const html = `<div class="user-list-item" onclick="enterChatRoom('${doc.id}', '${roomName}')"><div style="display:flex; align-items:center;"><img src="${roomImg}" class="user-list-img"><div><div class="user-name-bold">${roomName} ${adminBadge}</div><div style="font-size:12px; color:var(--text-sub); margin-top:4px;">${data.lastMessage || 'ëŒ€í™” ë‚´ìš© ì—†ìŒ'}</div></div></div></div>`; 
                listDiv.insertAdjacentHTML('beforeend', html);
            });
        }
        
        window.enterChatRoom = async (chatId, roomName) => {
            currentChatId = chatId;
            document.getElementById('chatTargetName').innerText = roomName; 
            document.getElementById('chat-room').style.display = 'flex'; 
            
            const myUid = auth.currentUser.uid;
            const chatDoc = await getDoc(doc(db, "chats", chatId));
            const data = chatDoc.data();
            
            if (auth.currentUser.email === ADMIN_EMAIL && !data.participants.includes(myUid)) {
                document.getElementById('chatInputArea').style.display = 'none';
                document.getElementById('admin-banner').style.display = 'block';
            } else {
                document.getElementById('chatInputArea').style.display = 'flex';
                document.getElementById('admin-banner').style.display = 'none';
            }
            
            loadMessages(chatId); 
        }

        window.leaveChat = async () => { if(!confirm("ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) return; const myUid = auth.currentUser.uid; try { const chatDocRef = doc(db, "chats", currentChatId); const chatDoc = await getDoc(chatDocRef); if (!chatDoc.exists()) { await setDoc(chatDocRef, { deletedBy: [myUid] }); } else { await updateDoc(chatDocRef, { deletedBy: arrayUnion(myUid) }); } closeChat(); goToPage('dm'); } catch(e) { console.error(e); } }
        window.closeChat = () => { document.getElementById('chat-room').style.display = 'none'; if(unsubscribeChat) unsubscribeChat(); }
        function loadMessages(chatId) { const msgBox = document.getElementById('chat-messages'); msgBox.innerHTML = ""; const q = query(collection(db, "chats", chatId, "messages"), orderBy("createdAt", "asc")); unsubscribeChat = onSnapshot(q, (snapshot) => { msgBox.innerHTML = ""; const myUid = auth.currentUser.uid; snapshot.forEach(doc => { const data = doc.data(); const isMine = data.uid === myUid; const typeClass = isMine ? 'msg-mine' : 'msg-other'; const time = new Date(data.createdAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); const html = `<div class="message-bubble ${typeClass}">${data.text}<div class="msg-time">${time}</div></div>`; msgBox.insertAdjacentHTML('beforeend', html); }); msgBox.scrollTop = msgBox.scrollHeight; }); }
        window.sendMsg = async () => { const input = document.getElementById('chatInput'); const text = input.value; if(!text) return; const myUid = auth.currentUser.uid; try { await addDoc(collection(db, "chats", currentChatId, "messages"), { text: text, uid: myUid, createdAt: new Date().toISOString() }); const chatDocRef = doc(db, "chats", currentChatId); await setDoc(chatDocRef, { lastMessage: text, updatedAt: new Date().toISOString(), deletedBy: [] }, { merge: true }); await updateDoc(doc(db, "users", currentTargetUid), { [`unread.${myUid}`]: increment(1) }); input.value = ""; } catch(e) {} }

        window.goToPage = (pageName) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(pageName === 'main') { document.getElementById('main-page').classList.add('active'); document.querySelector('.nav-item:nth-child(1)').classList.add('active'); }
            else if(pageName === 'explore') { document.getElementById('explore-page').classList.add('active'); loadAllUsersForExplore(); document.querySelector('.nav-item:nth-child(2)').classList.add('active'); }
            else if(pageName === 'noti') { document.getElementById('noti-page').classList.add('active'); document.querySelector('.nav-item:nth-child(3)').classList.add('active'); }
            else if(pageName === 'dm') { document.getElementById('dm-page').classList.add('active'); loadAllChatList(); document.querySelector('.nav-item:nth-child(4)').classList.add('active'); }
            else if(pageName === 'profile') { goToMyProfile(); }
        }

        async function loadAllUsersForExplore() {
            const listDiv = document.getElementById('explore-user-list'); 
            listDiv.innerHTML = "";
            const userIds = Object.keys(allUsersCache);
            userIds.forEach(uid => {
                const data = allUsersCache[uid]; 
                const img = data.photoURL ? data.photoURL : "https://via.placeholder.com/40";
                const handle = data.handle ? "@" + data.handle : "";
                const html = `<div class="user-list-item" onclick="goToUserProfile('${uid}')"><div style="display:flex; align-items:center;"><img src="${img}" class="user-list-img"><div><div class="user-name-bold">${data.name}</div><div style="font-size:12px; color:var(--text-sub);">${handle}</div></div></div></div>`; 
                listDiv.insertAdjacentHTML('beforeend', html);
            });
        }
        
        document.getElementById('submitAuthBtn').addEventListener('click', async () => { const e = document.getElementById('emailInput').value; const p = document.getElementById('pwInput').value; const n = document.getElementById('nickNameInput').value; const h = document.getElementById('handleInput').value; const c = document.getElementById('inviteCodeInput').value; 
            try { 
                if (isSignupMode) { 
                    if(!h) return alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); 
                    if(c !== INVITE_CODE) return alert("ì´ˆëŒ€ ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); 
                    const q = query(collection(db, "users"), where("handle", "==", h)); 
                    const snapshot = await getDocs(q); 
                    if(!snapshot.empty) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤."); 
                    const r = await createUserWithEmailAndPassword(auth, e, p); 
                    await updateProfile(r.user, { displayName: n }); 
                    await setDoc(doc(db, "users", r.user.uid), { email: e, name: n, handle: h, photoURL: null, usedStorage: 0, bio: "", unread: {}, website: "", isApproved: true }); 
                    alert("ê°€ì…ì™„ë£Œ"); 
                } else { 
                    await signInWithEmailAndPassword(auth, e, p); 
                    alert("ë¡œê·¸ì¸ì™„ë£Œ"); 
                } 
                document.getElementById('auth-form').style.display = 'none'; 
            } catch (er) { 
                // [NEW] ë¡œê·¸ì¸ ì—ëŸ¬ ë©”ì‹œì§€ í•œê¸€í™”
                if (er.code === 'auth/user-not-found' || er.code === 'auth/wrong-password' || er.code === 'auth/invalid-credential' || er.code === 'auth/invalid-login-credentials') {
                    alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì´ë©”ì¼ ê³„ì •ì´ ì—†ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                } else {
                    alert("ì—ëŸ¬: " + er.message); 
                }
            } 
        });
    </script>
</body>
</html>
